  <tr class="sortable-columns">
    <template  ngFor let-columnName [ngForOf]="visibleColumns" let-columnIndex="index">
      <th *ngIf="currentComboboxIndex == columnIndex" class="combo-th">
        <div class="add-column combobox is-active">
          <add-column-combobox
            [columnsConfig]="columnsConfig"
            [visibleColumns]="visibleColumns"
            (selected)="selectNewColumn($event, columnIndex)"
            attr.id="combobox-{{columnIndex}}">
          </add-column-combobox>
          <span class="add-column-button">
            <span (click)="currentComboboxIndex = null" class="add-column-button combo-toggle btn btn-sm btn-success is-active">+</span>
          </span>
        </div>
      </th>
      <th class="drag-column"
        #columnHeader
        attr.data-col-ref="{{ columnsConfigLookup[columnName].column }}"
        attr.id="col-id-{{ columnsConfigLookup[columnName].column }}"
        [class.is-sorted]="columnHeader.isSorted"
        [class.is-sorted--asc]="columnHeader.isSorted && columnHeader.currentSortDirection === 'asc'"
        [class.is-sorted--desc]="columnHeader.isSorted && columnHeader.currentSortDirection === 'desc'">

        <span class="col-label" (click)="!columnsConfigLookup[columnName].sortingDisabled && sortColumn(col, columnHeader)" >
          {{ columnsConfigLookup[columnName].text || columnsConfigLookup[columnName].id  }}
          <i *ngIf="showSortIcon(col, columnHeader, 'alpha', 'asc')" class="ico-col-sort ico-col-sort--asc"><i>A</i><i>Z</i><i>↓</i></i>
          <i *ngIf="showSortIcon(col, columnHeader, 'alpha', 'desc')" class="ico-col-sort ico-col-sort--desc"><i>Z</i><i>A</i><i>↓</i></i>
          <i *ngIf="showSortIcon(col, columnHeader, 'num', 'asc')" class="ico-col-sort ico-col-sort--asc"><i>0</i><i>9</i><i>↓</i></i>
          <i *ngIf="showSortIcon(col, columnHeader, 'num', 'desc')" class="ico-col-sort ico-col-sort--desc"><i>9</i><i>0</i><i>↓</i></i>
        </span>

        <div class="btn-group col-menu" dropdown>
          <a class="btn btn-sm btn-secondary dropdown-toggle" href [id]="columnsConfigLookup[columnName].column + '-dropdown'" dropdownToggle></a>

          <ul class="dropdown-menu dropdown-menu-right" dropdownMenu attr.aria-labelledby="{{columnsConfigLookup[columnName].column}}-dropdown">

            <li *ngIf="!columnsConfigLookup[columnName].sortingDisabled">
              <a class="dropdown-item" (click)="sortColumn(col, 'asc')">
                Sortieren
                <span *ngIf="columnsConfigLookup[columnName].sortType === 'num'">0&rarr;9</span>
                <span *ngIf="columnsConfigLookup[columnName].sortType !== 'num'">A&rarr;Z</span>
              </a>
            </li>

            <li *ngIf="!columnsConfigLookup[columnName].sortingDisabled">
              <a class="dropdown-item" (click)="sortColumn(col, 'desc')">
                Sortieren
                <span *ngIf="columnsConfigLookup[columnName].sortType === 'num'">9&rarr;0</span>
                <span *ngIf="columnsConfigLookup[columnName].sortType !== 'numm'">Z&rarr;A</span>
              </a>
            </li>

            <li *ngIf="!columnsConfigLookup[columnName].sortingDisabled" class="divider dropdown-divider"></li>

            <li>
              <a [class.disabled]="hasAllColumnsVisble" class="dropdown-item" (click)="!hasAllColumnsVisble && addCombobox(columnIndex)">
                Spalte links hinzufügen
              </a>
            </li>

            <li>
              <a [class.disabled]="hasAllColumnsVisble" class="dropdown-item" (click)="!hasAllColumnsVisble && addCombobox(columnIndex + 1)">
                Spalte rechts hinzufügen
              </a>
            </li>

            <li *ngIf="columnsConfigLookup[columnName].subFields" class="divider dropdown-divider"></li>
            <li *ngIf="columnsConfigLookup[columnName].subFields" class="dropdown-item-group">
              <span class="dropdown-header">Felder in der Spalte</span>

              <div *ngFor="let subcolumn of columnsConfigLookup[columnName].subFields">
                <label class="dropdown-item c-input c-checkbox">
                  <input type="checkbox"
                      (change)="onRemoveSubcolumn(columnsConfigLookup[columnName].column, subcolumn.column)"
                      [checked]="subcolumn.isVisible"
                  >
                  <span class="c-indicator"></span>
                  {{subcolumn.text || subcolumn.id }}
                </label>
              </div>
            </li>

            <li class="divider dropdown-divider"></li>
            <li>
              <a class="dropdown-item" (click)="onRemoveColumn(columnsConfigLookup[columnName].column, columnIndex)">
                Diese Spalte entfernen
              </a>
            </li>

          </ul>
        </div>
      </th>
    </template>
    <th class="combo-th">
      <div class="add-column combobox" [ngClass]="lastColumnComboboxActive ? 'is-active' : 'is-inactive'">
        <add-column-combobox
          *ngIf="lastColumnComboboxActive"
          [columnsConfig]="columnsConfig"
          [visibleColumns]="visibleColumns"
          (selected)="selectNewColumn($event)"
        ></add-column-combobox>
        <span
            (click)="toggleCombobox()"
            class="add-column-button combo-toggle btn btn-sm btn-success"
            [ngClass]="{'is-active': combobox }"
        >+</span>
      </div>
    </th>
  </tr>
